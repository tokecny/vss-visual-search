{"ast":null,"code":"// This file is module for offline service such as save file, read file, etc with local storage or indexedDB.\n// Author : Waragon P.\n\n// ฟังก์ชันบันทึกข้อมูลใน Local Storage\nfunction saveDataToLocalStorage(key, value) {\n  // แปลงข้อมูลเป็น string ก่อนบันทึก\n  localStorage.setItem(key, JSON.stringify(value));\n}\n\n// ฟังก์ชันดึงข้อมูลจาก Local Storage\nfunction getDataFromLocalStorage(key) {\n  const value = localStorage.getItem(key);\n  if (value) {\n    try {\n      // แปลงข้อมูลกลับจาก string เป็นค่าเดิม\n      return JSON.parse(value);\n    } catch (e) {\n      console.error(\"Error parsing data from localStorage\", e);\n      return null;\n    }\n  }\n  return null; // ถ้าไม่มีข้อมูลหรือเป็น null\n}\n\nfunction saveDataToIndexedDB(data, DBname) {\n  // Create request to open a indexed database\n  const IDBrequest = window.indexedDB.open(DBname);\n\n  // If error\n  IDBrequest.onerror = function (event) {\n    console.log(\"IndexedDB error: \" + event.target.errorCode);\n  };\n\n  // If upgrade needed\n  IDBrequest.onupgradeneeded = function (event) {\n    const db = IDBrequest.result;\n    if (!db.objectStoreNames.contains(\"data\")) {\n      db.createObjectStore(\"data\");\n    }\n  };\n\n  // If success\n  IDBrequest.onsuccess = function (event) {\n    const db = IDBrequest.result;\n    const transaction = db.transaction([\"data\"], \"readwrite\");\n    const objectStore = transaction.objectStore(\"data\");\n    const request = objectStore.add(data, new Date().getTime());\n    request.onsuccess = function (event) {\n      console.log(\"Data has been added to your database.\");\n    };\n    transaction.oncomplete = function (event) {\n      db.close();\n    };\n  };\n}\nfunction getDataFromIndexedDB(DBname, DBversion, DBstore) {\n  // Create request to open a indexed database\n  const IDBrequest = window.indexedDB.open(DBname, DBversion);\n\n  // If error\n  IDBrequest.onerror = function (event) {\n    console.log(\"IndexedDB error: \" + event.target.errorCode);\n  };\n\n  // If success\n  IDBrequest.onsuccess = function (event) {\n    const db = IDBrequest.result;\n    const transaction = db.transaction([DBstore], \"readwrite\");\n    const objectStore = transaction.objectStore(DBstore);\n    const request = objectStore.getAll();\n    request.onsuccess = function (event) {\n      console.log(\"Data has been added to your database.\");\n    };\n    transaction.oncomplete = function (event) {\n      db.close();\n    };\n  };\n}\nfunction saveDataToClientDevice(data, filename) {\n  const blob = new Blob([data], {\n    type: 'text/plain'\n  });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.setAttribute('download', filename);\n  a.setAttribute('href', url);\n  a.click();\n}\nfunction saveJSONDataToClientDevice(data, filename) {\n  saveDataToClientDevice(JSON.stringify(data), filename);\n}\nfunction saveCSVDataToClientDevice(data, filename) {\n  // ตรวจสอบและเพิ่มนามสกุล .csv หากไม่มี\n  if (!filename.endsWith('.csv')) {\n    filename += '.csv';\n  }\n\n  // แปลง JSON เป็น CSV\n  const csvContent = convertJSONToCSV(data);\n\n  // สร้าง Blob และดาวน์โหลดไฟล์\n  const blob = new Blob([csvContent], {\n    type: 'text/csv'\n  });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.setAttribute('download', filename);\n  a.setAttribute('href', url);\n  a.click();\n}\nfunction convertJSONToCSV(data) {\n  if (!Array.isArray(data) || data.length === 0) {\n    return '';\n  }\n\n  // ดึงหัวข้อจาก key ของ object ตัวแรก\n  const headers = Object.keys(data[0]);\n\n  // สร้างแถวของหัวข้อและข้อมูล\n  const rows = data.map(row => headers.map(header => {\n    var _row$header;\n    return `\"${((_row$header = row[header]) !== null && _row$header !== void 0 ? _row$header : '').toString().replace(/\"/g, '\"\"')}\"`;\n  }).join(','));\n\n  // รวม headers และ rows เป็น CSV\n  return [headers.join(','), ...rows].join('\\n');\n}\nexport { saveCSVDataToClientDevice, convertJSONToCSV, saveDataToLocalStorage, saveDataToIndexedDB, saveDataToClientDevice, saveJSONDataToClientDevice, getDataFromLocalStorage, getDataFromIndexedDB };","map":{"version":3,"names":["saveDataToLocalStorage","key","value","localStorage","setItem","JSON","stringify","getDataFromLocalStorage","getItem","parse","e","console","error","saveDataToIndexedDB","data","DBname","IDBrequest","window","indexedDB","open","onerror","event","log","target","errorCode","onupgradeneeded","db","result","objectStoreNames","contains","createObjectStore","onsuccess","transaction","objectStore","request","add","Date","getTime","oncomplete","close","getDataFromIndexedDB","DBversion","DBstore","getAll","saveDataToClientDevice","filename","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","setAttribute","click","saveJSONDataToClientDevice","saveCSVDataToClientDevice","endsWith","csvContent","convertJSONToCSV","Array","isArray","length","headers","Object","keys","rows","map","row","header","_row$header","toString","replace","join"],"sources":["/Users/pavlov/Documents/GitHub/vss-visual-search/src/uitls/offline.ts"],"sourcesContent":["// This file is module for offline service such as save file, read file, etc with local storage or indexedDB.\n// Author : Waragon P.\n\n// ฟังก์ชันบันทึกข้อมูลใน Local Storage\nfunction saveDataToLocalStorage(key: string, value: any) {\n    // แปลงข้อมูลเป็น string ก่อนบันทึก\n    localStorage.setItem(key, JSON.stringify(value));\n}\n\n// ฟังก์ชันดึงข้อมูลจาก Local Storage\nfunction getDataFromLocalStorage(key: string) {\n    const value = localStorage.getItem(key);\n    if (value) {\n        try {\n            // แปลงข้อมูลกลับจาก string เป็นค่าเดิม\n            return JSON.parse(value);\n        } catch (e) {\n            console.error(\"Error parsing data from localStorage\", e);\n            return null;\n        }\n    }\n    return null; // ถ้าไม่มีข้อมูลหรือเป็น null\n}\n\nfunction saveDataToIndexedDB(data:any, DBname:string) {\n    // Create request to open a indexed database\n    const IDBrequest: IDBOpenDBRequest = window.indexedDB.open(DBname);\n  \n    // If error\n    IDBrequest.onerror = function(event) {\n        console.log(\"IndexedDB error: \" + (event.target as any).errorCode);\n    };\n  \n    // If upgrade needed\n    IDBrequest.onupgradeneeded = function(event) {\n        const db = IDBrequest.result;\n        if (!db.objectStoreNames.contains(\"data\")) {\n            db.createObjectStore(\"data\");\n        }\n    };\n  \n    // If success\n    IDBrequest.onsuccess = function(event) {\n\n        const db = IDBrequest.result;\n  \n        const transaction = db.transaction([\"data\"], \"readwrite\");\n        const objectStore: IDBObjectStore = transaction.objectStore(\"data\");\n        const request = objectStore.add(data, new Date().getTime());\n\n        request.onsuccess = function(event) {\n            console.log(\"Data has been added to your database.\");\n        };\n\n        transaction.oncomplete = function(event) {\n            db.close();\n        };\n        \n    };\n\n  }\n\nfunction getDataFromIndexedDB(DBname:string, DBversion:number, DBstore:string) {\n\n    // Create request to open a indexed database\n    const IDBrequest: IDBRequest = window.indexedDB.open(DBname, DBversion);\n\n    // If error\n    IDBrequest.onerror = function(event) {\n        console.log(\"IndexedDB error: \" + (event.target as any).errorCode);\n    };  \n\n    // If success\n    IDBrequest.onsuccess = function(event) {\n        const db = IDBrequest.result;\n        const transaction = db.transaction([DBstore], \"readwrite\");\n        const objectStore = transaction.objectStore(DBstore);\n        const request = objectStore.getAll();\n        request.onsuccess = function(event) {\n            console.log(\"Data has been added to your database.\");\n        };\n        transaction.oncomplete = function(event) {\n            db.close();\n        };\n    };\n}\n\n\nfunction saveDataToClientDevice(data: any, filename: string) {\n    const blob = new Blob([data], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.setAttribute('download', filename);\n    a.setAttribute('href', url);\n    a.click();\n}\n\nfunction saveJSONDataToClientDevice(data: any, filename: string) {\n    saveDataToClientDevice(JSON.stringify(data), filename);\n}\n\nfunction saveCSVDataToClientDevice(data: any[], filename: string) {\n    // ตรวจสอบและเพิ่มนามสกุล .csv หากไม่มี\n    if (!filename.endsWith('.csv')) {\n        filename += '.csv';\n    }\n\n    // แปลง JSON เป็น CSV\n    const csvContent = convertJSONToCSV(data);\n\n    // สร้าง Blob และดาวน์โหลดไฟล์\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.setAttribute('download', filename);\n    a.setAttribute('href', url);\n    a.click();\n}\n\nfunction convertJSONToCSV(data: any[]): string {\n    if (!Array.isArray(data) || data.length === 0) {\n        return '';\n    }\n\n    // ดึงหัวข้อจาก key ของ object ตัวแรก\n    const headers = Object.keys(data[0]);\n\n    // สร้างแถวของหัวข้อและข้อมูล\n    const rows = data.map((row) =>\n        headers.map((header) => `\"${(row[header] ?? '').toString().replace(/\"/g, '\"\"')}\"`).join(',')\n    );\n\n    // รวม headers และ rows เป็น CSV\n    return [headers.join(','), ...rows].join('\\n');\n}\n\nexport {\n    saveCSVDataToClientDevice,\n    convertJSONToCSV,\n    saveDataToLocalStorage,\n    saveDataToIndexedDB,\n    saveDataToClientDevice,\n    saveJSONDataToClientDevice,\n    getDataFromLocalStorage,\n    getDataFromIndexedDB\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}